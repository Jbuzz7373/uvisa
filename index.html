<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>U Visa Case Status Lookup</title>
  <style>
    body{font-family:Arial, sans-serif; max-width:820px; margin:40px auto; padding:0 16px;}
    h2{margin:0 0 14px; text-align:center;}
    .row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:12px 0 10px;}
    input{padding:10px; font-size:16px; width:240px;}
    button{padding:10px 14px; font-size:16px; cursor:pointer;}
    .muted{color:#666; font-size:13px; margin:10px 0 0; text-align:center;}
    .card{border:1px solid #ccc; border-radius:10px; padding:16px; margin:18px auto 0; max-width:560px;}
    .label{font-size:12px; color:#666; margin-top:10px;}
    .value{font-size:16px;}
    .error{border-color:#c00; color:#900;}
  </style>
</head>
<body>

  <h2>U Visa Case Status Lookup</h2>

  <div class="row">
    <input id="caseNo" placeholder="Case Number" />
    <button id="btnSearch" type="button">Search</button>
  </div>

  <div class="muted">Enter your Case Number to view status.</div>

  <div id="out"></div>

<script>
(function () {
  const out = document.getElementById('out');
  const caseInput = document.getElementById('caseNo');
  const btn = document.getElementById('btnSearch');

  let rows = null;

  function normCase(v){
    return (v || '')
      .toString()
      .trim()
      .toUpperCase()
      .replace(/\s+/g,''); // remove spaces
  }

  async function loadData(){
    if (rows) return rows;
    const res = await fetch('./data.json', { cache: 'no-store' });
    if (!res.ok) throw new Error(`Failed to load data.json (HTTP ${res.status})`);
    rows = await res.json();
    return rows;
  }

  async function lookup(){
    try {
      const c = normCase(caseInput.value);
      out.innerHTML = '';

      if(!c){
        out.innerHTML = `<div class="card">Enter a Case Number.</div>`;
        return;
      }

      out.innerHTML = `<div class="card">Loadingâ€¦</div>`;

      const data = await loadData();

      // exact match
      let rec = data.find(r => normCase(r.CaseNumber) === c);

      // fallback: allow users to omit dashes
      if(!rec){
        const cNoDash = c.replace(/-/g,'');
        rec = data.find(r => normCase(r.CaseNumber).replace(/-/g,'') === cNoDash);
      }

      if(!rec){
        out.innerHTML = `<div class="card">No record found for that Case Number.</div>`;
        return;
      }

      const mail = rec.MailOutDate ? rec.MailOutDate : 'Not mailed yet';

      out.innerHTML = `
        <div class="card">
          <div class="label">Case Number</div>
          <div class="value">${rec.CaseNumber}</div>

          <div class="label">Decision</div>
          <div class="value">${rec.Decision || ''}</div>

          <div class="label">Mailed Out Date</div>
          <div class="value">${mail}</div>
        </div>`;
    } catch (e) {
      out.innerHTML = `<div class="card error"><b>Error:</b> ${e.message}</div>`;
    }
  }

  btn.addEventListener('click', lookup);
  caseInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') lookup();
  });
})();
</script>

</body>
</html>
