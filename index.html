<script>
let rows = null;

function norm(v){
  return (v||'')
    .toString()
    .trim()
    .toUpperCase()
    .replace(/\s+/g,'');     // remove all spaces
}

// also normalize case numbers by removing spaces only (keep dashes)
function normCase(v){
  return (v||'')
    .toString()
    .trim()
    .toUpperCase()
    .replace(/\s+/g,'');     // remove spaces, keep dashes
}

async function loadData(){
  if (rows) return rows;
  const res = await fetch('data.json', { cache: 'no-store' });
  rows = await res.json();
  return rows;
}

async function lookup(){
  const c = normCase(document.getElementById('caseNo').value);
  const out = document.getElementById('out');
  out.innerHTML = '';

  if(!c){
    out.innerHTML = `<div class="card">Enter a Case Number.</div>`;
    return;
  }

  const data = await loadData();

  // try exact match first
  let rec = data.find(r => normCase(r.CaseNumber) === c);

  // fallback: if users omit dashes, match by removing dashes on both sides
  if(!rec){
    const cNoDash = c.replace(/-/g,'');
    rec = data.find(r => normCase(r.CaseNumber).replace(/-/g,'') === cNoDash);
  }

  if(!rec){
    out.innerHTML = `<div class="card">No record found for that Case Number.</div>`;
    return;
  }

  const mail = rec.MailOutDate ? rec.MailOutDate : 'Not mailed yet';

  out.innerHTML = `
    <div class="card">
      <div class="label">Case Number</div>
      <div class="value">${rec.CaseNumber}</div>

      <div class="label">Decision</div>
      <div class="value">${rec.Decision || ''}</div>

      <div class="label">Mailed Out Date</div>
      <div class="value">${mail}</div>
    </div>
  `;
}
</script>
